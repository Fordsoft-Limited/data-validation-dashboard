<div class="card">
  <form [formGroup]="filterForm" (ngSubmit)="filterData()">
    <div class="flex gap-5 mb-4 justify-content-center flex-wrap">
      <div class="flex flex-column gap-2">
        <label for="region">Region:</label>
        <!-- <input type="text" formControlName="region" pInputText placeholder="Enter Region" class="region-input" /> -->
        <p-dropdown formControlName="region" [options]="regions"[editable]="true" (onChange)="onRegionChange($event)" placeholder="Enter Region"></p-dropdown>
      </div>

      <div class="flex flex-column gap-2">
        <label for="businessUnit">Business Unit:</label>
        <p-dropdown formControlName="businessUnit" [options]="businessUnits" [editable]="true" (onChange)="onBusinessHubChange($event)" placeholder="Select Business Unit"></p-dropdown>
      </div>

      <div class="flex flex-column gap-2">
        <label for="feeder">Service:</label>
        <p-dropdown formControlName="feeder" [options]="feeders" [editable]="true" placeholder="Select Service"></p-dropdown>
      </div>

    <div class="flex flex-column gap-2">
      <label for="dateRange">Date Range:</label>
      <div class="flex gap-2"> 
        <input type="date" formControlName="dateCreatedFrom" pInputText class="date-from" />
        <input type="date" formControlName="dateCreatedTo" pInputText class="date-to" />
      </div>
    </div>
      <div class="flex gap-2 mt-4">
        <p-button type="submit"  label="Filter"></p-button> 
        
      </div>
    </div>
  </form>

  <p-table [value]="filteredRecords" [loading]="loading" [paginator]="true" [rows]="100"
    (onRowSelect)="showDetails($event.data)">

    <ng-template pTemplate="caption">
      <div class="flex justify-content-end gap-2">
        <!-- <p-button label="Clear" [outlined]="true" icon="pi pi-filter-slash" (click)="resetFilter()"/> -->
        <!-- <p-button label="Show Details" (click)="openDialog()" class="ml-3" [loading]="isShowDetails"
          [disabled]="!selectedApprovedRecord"></p-button> -->
          <p-button
          [loading]="exportLoading"  (click)="exportData()"  label="Export" icon="pi pi-download" class="p-button-help"></p-button>

      </div>
    </ng-template>
    <ng-template pTemplate="header">
      <tr>
        <!-- <th style="width: 4rem"><p-tableRadioButton /></th> -->
        <th style="min-width:15rem">Customer No</th>
        <th style="min-width:15rem">Customer Name</th>
        <th style="min-width:15rem">Feeder</th>
        <th style="min-width:15rem">Status</th>
        <!-- <th style="min-width:10rem">Date Captured</th> -->
        <th style="min-width:10rem">Date Modified</th>
        <th style="min-width:6rem">Action</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-record>
      <tr class="cursor-pointer">
        <!-- <td><p-tableRadioButton [value]="record" /></td> -->
        <td>{{ record.customer_no }}</td>
        <td>{{ record.customer_full_name }}</td>
        <td>{{ record.feeder }}</td>
        <td> <p-tag [value]="record.approval_status" [severity]="getSeverity(record.approval_status)" /></td>
        <!-- <td>{{ record. date_created | date: 'MM/dd/yyyy' }}</td> -->
        <td>{{ record.last_modified | date: 'MM/dd/yyyy' }}</td>
        <td>
          <button pButton icon="pi pi-eye" class="p-button-text" (click)="viewDetails(record)"></button>
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="6">No records found.</td>
      </tr>
    </ng-template>
  </p-table>

  <p-dialog [(visible)]="showDetailsDialog" modal="modal" [closable]="true"
    [header]="selectedApprovedRecord?.customerFullName">
    <div *ngIf="selectedApprovedRecord" class="grid">
      <div class="col-12">
        <p><strong>Customer Full Name:</strong> {{ selectedApprovedRecord.customerFullName }}</p>
        <p><strong>Account No:</strong> {{ selectedApprovedRecord.cin }}</p>
        <p><strong>Feeder:</strong> {{ selectedApprovedRecord.feeder }}</p>
        <p><strong>Date Captured:</strong> {{ selectedApprovedRecord.date | date: 'MM/dd/yyyy' }}</p>
        <p><strong>Date Approved:</strong> {{ selectedApprovedRecord.dateApproved | date: 'MM/dd/yyyy' }}</p>

      </div>
    </div>
  </p-dialog>
</div>