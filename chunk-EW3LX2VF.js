import{a as he}from"./chunk-J2QXRKIG.js";import{a as Ce}from"./chunk-DPSOT3CL.js";import{b as ge,c as _e}from"./chunk-X22465MG.js";import"./chunk-PSUU27KI.js";import{b as we}from"./chunk-JK2WCNHE.js";import{b as ee}from"./chunk-EYNK32OA.js";import{b as X}from"./chunk-SDXV7PTX.js";import{a as pe}from"./chunk-ZUNNH25A.js";import{a as fe}from"./chunk-FIIS3JHD.js";import{e as Y,f as te,g as ie,h as re,i as de,j as ue,k as ce}from"./chunk-GKUFW2RI.js";import{a as $}from"./chunk-D6OM4TL4.js";import{c as me}from"./chunk-UNZMK42Y.js";import"./chunk-VZKXXVR6.js";import"./chunk-NG4D23UF.js";import{a as H}from"./chunk-HDDFEM7G.js";import{d as oe,f as se,l as ne,m as le,n as ae}from"./chunk-VTKS6MIP.js";import"./chunk-XVURSSVY.js";import"./chunk-KMIFLFRM.js";import"./chunk-5TMXRYYI.js";import{h as Z}from"./chunk-JSMWOMP6.js";import"./chunk-5Q75OANQ.js";import{$ as D,Ab as A,Ca as E,D as d,Da as R,Db as U,E as u,Ea as V,Fa as B,Ia as N,Mc as Q,Q as c,R as p,Ra as I,Ta as k,Tb as L,Ub as W,Vb as O,ba as f,cc as b,ha as r,hb as P,hc as z,ia as o,ib as j,ja as w,na as S,oa as h,pa as g,s as y,sc as G,tc as K,uc as q,vc as J,x as T,y as M,ya as m,za as _}from"./chunk-AWEHUNTX.js";import{a as F}from"./chunk-DM275RSA.js";var xe=()=>[10,25,50],Ne=()=>["feeder","meterNo","date","status"];function Fe(s,C){if(s&1){let e=S();r(0,"div",8)(1,"p-button",9),h("click",function(){d(e);let t=g();return u(t.navigateToDetails())}),o(),r(2,"div",10)(3,"a",11),h("click",function(){d(e);let t=g();return u(t.openSearch())}),w(4,"i",12),o(),r(5,"a",11),h("click",function(){d(e);let t=g();return u(t.reload())}),w(6,"i",13),o()()()}if(s&2){let e=g();c(),f("loading",e.loading)("disabled",e.selectedNewCustomer.length===0)}}function ye(s,C){s&1&&(r(0,"tr")(1,"th",14),w(2,"p-tableHeaderCheckbox"),o(),r(3,"th",15),m(4,"Customer No"),o(),r(5,"th",15),m(6,"Customer Name"),o(),r(7,"th",15),m(8,"Feeder"),o(),r(9,"th",15),m(10,"Status"),o(),r(11,"th",16),m(12,"Date Modified"),o(),r(13,"th",16),m(14,"Action"),o()())}function Te(s,C){if(s&1){let e=S();r(0,"tr",17)(1,"td"),w(2,"p-tableCheckbox",18),o(),r(3,"td"),m(4),o(),r(5,"td"),m(6),o(),r(7,"td"),m(8),o(),r(9,"td"),w(10,"p-tag",19),o(),r(11,"td"),m(12),I(13,"date"),o(),r(14,"td")(15,"button",20),h("click",function(){let t=d(e).$implicit,l=g();return u(l.viewDetails(t))}),o()()()}if(s&2){let e=C.$implicit,i=g();c(2),f("value",e),c(2),_(e.customer_no),c(2),_(e.customer_full_name),c(2),_(e.feeder),c(2),f("value",e.approval_status)("severity",i.getSeverity(e.approval_status)),c(2),_(k(13,7,e.last_modified,"MM/dd/yyyy"))}}function Me(s,C){s&1&&(r(0,"tr")(1,"td",21),m(2,"No customer records found."),o()())}var ve=(()=>{class s{constructor(e,i,t,l,a,n){this.fb=e,this.customerService=i,this.router=t,this.authService=l,this.messageService=a,this.utilService=n,this.filteredNewCustomers=[],this.loading=!1,this.hasErrors=!1,this.errorMessage="",this.totalRecords=0,this.regions=[],this.businessUnits=[],this.feeders=[],this.isFilterLoading=!1,this.isResetLoading=!1,this.userAddedError=!1,this.isShowDetails=!1,this.searchValue="",this.currentPage=1,this.pageSize=100,this.showDetailsDialog=!1,this.selectedCustomer=null,this.selectedNewCustomer=[],this.filterForm=this.fb.group({dateRange:[],feeder:[],businessUnit:[]})}ngOnInit(){this.reload()}reload(){this.loadNewCustomer(this.currentPage,this.pageSize)}openSearch(){this.showDetailsDialog=!0}filterApplied(e){console.log(e),this.filteredNewCustomers=e?.results,this.totalRecords=e?.count}onClearFilters(){this.reload()}onDialogClosed(e){this.showDetailsDialog=e}loadNewCustomer(e,i){this.loading=!0,this.customerService.getCustomerFilterByPages(e,i).subscribe(t=>{this.loading=!1,t&&t.data&&t.data.results?(this.filteredNewCustomers=t.data.results,this.totalRecords=t.data.count):(this.filteredNewCustomers=[],this.messageService.add({severity:"info",summary:"No Data",detail:"No new customer found."}))},t=>{this.loading=!1,console.error("Error fetching new customer:",t),this.filteredNewCustomers=[],this.messageService.add({severity:"error",summary:"Error",detail:"Failed to load customers."})})}onRegionChange(e){let i=e.value;this.updateBusinessUnits(i),this.filterForm.get("businessUnit")?.reset(),this.filterForm.get("feeder")?.reset()}onBusinessHubChange(e){let i=e.value;this.updateFeeders(i),this.filterForm.get("feeder")?.reset()}updateBusinessUnits(e){this.businessUnits=e.businessHubs.map(i=>({label:i.name,value:i}))}updateFeeders(e){e&&e.serviceCentres?this.feeders=e.serviceCentres.map(i=>({label:i.name,value:i})):this.feeders=[]}filterData(){this.loading=!0;let{dateCreatedFrom:e,dateCreatedTo:i,feeder:t,businessUnit:l,region:a}=this.filterForm.value,n=a?a.name:null,x=l?l.name:null,Se=t?t.name:null;this.customerService.getNewCustomerFilter(n,x,Se,e,i).subscribe(v=>{console.log("Filtered customers:",v),this.newCustomers=v.data?.results||[],this.filteredNewCustomers=[...this.newCustomers],this.loading=!1},v=>{console.error("Error loading customers:",v),this.errorMessage="Failed to load customers. Please try again later.",this.loading=!1})}resetFilter(){this.isResetLoading=!0,setTimeout(()=>{this.isResetLoading=!1,this.filterForm.reset(),this.filteredNewCustomers=[...this.newCustomers]},2e3)}isWithinDateRange(e,i){let[t,l]=i,a=new Date(e).getTime(),n=new Date(t).getTime(),x=new Date(l).getTime();return a>=n&&a<=x}showDetails(e){this.selectedCustomer=F({},e)}navigateToDetails(){let e=this.selectedNewCustomer[0].uid;this.utilService.saveItems(this.selectedNewCustomer),this.router.navigate(["app/validate/review/"+e])}viewDetails(e){this.router.navigate(["/app/customer-details",e.uid])}clear(e){e.clear()}onGlobalFilter(e,i){e.filterGlobal(i.target.value,"contains")}getSeverity(e){switch(e){case"Approved":return"success";case"Awaiting review":return"warning";case"Rejected":return"danger";default:return"info"}}static{this.\u0275fac=function(i){return new(i||s)(p(L),p(pe),p(A),p(H),p(b),p(he))}}static{this.\u0275cmp=T({type:s,selectors:[["app-new-customer"]],features:[B([b,Ce])],decls:8,vars:11,consts:[["dt1",""],[1,"card"],["dataKey","uid","scrollHeight","400px",3,"selectionChange","onRowSelect","value","selection","rows","rowsPerPageOptions","loading","paginator","globalFilterFields","scrollable"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[3,"filterApplied","clearFiltersEvent","closeFiltersEvent","display"],[1,"flex",2,"display","flex","justify-content","space-between"],["label","Review",1,"ml-3",3,"click","loading","disabled"],[2,"display","flex","justify-content","flex-end","gap","20px"],[1,"p-button","p-button-outlined","font-bold","p-button-help","custom-button",3,"click"],[1,"pi","pi-filter"],[1,"pi","pi-refresh"],[2,"width","4rem"],[2,"min-width","15rem"],[2,"min-width","10rem"],[1,"cursor-pointer"],[3,"value"],[3,"value","severity"],["pButton","","icon","pi pi-eye",1,"p-button-text",3,"click"],["colspan","6"]],template:function(i,t){if(i&1){let l=S();r(0,"div",1)(1,"p-table",2,0),V("selectionChange",function(n){return d(l),R(t.selectedNewCustomer,n)||(t.selectedNewCustomer=n),u(n)}),h("onRowSelect",function(n){return d(l),u(t.showDetails(n.data))}),D(3,Fe,7,2,"ng-template",3)(4,ye,15,0,"ng-template",4)(5,Te,16,10,"ng-template",5)(6,Me,3,0,"ng-template",6),o(),r(7,"app-filter",7),h("filterApplied",function(n){return d(l),u(t.filterApplied(n))})("clearFiltersEvent",function(){return d(l),u(t.onClearFilters())})("closeFiltersEvent",function(n){return d(l),u(t.onDialogClosed(n))}),o()()}i&2&&(c(),f("value",t.filteredNewCustomers),E("selection",t.selectedNewCustomer),f("rows",100)("rowsPerPageOptions",N(9,xe))("loading",t.loading)("paginator",!0)("globalFilterFields",N(10,Ne))("scrollable",!0),c(6),f("display",t.showDetailsDialog))},dependencies:[se,z,ne,le,K,q,de,ge,P]})}}return s})();var De=[{path:"",component:ve}],ft=(()=>{class s{static{this.\u0275fac=function(i){return new(i||s)}}static{this.\u0275mod=M({type:s})}static{this.\u0275inj=y({imports:[j,U.forChild(De),O,W,ae,X,J,Q,oe,fe,G,te,ce,ee,Z,ue,we,$,me,re,ie,Y,_e]})}}return s})();export{ft as NewCustomerModule,De as newCustomerRoute};
